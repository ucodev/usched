#!/bin/sh
#
# uConf: Setup configuration script
#
# Copyright 2014-2015 Pedro A. Hortas (pah@ucodev.org)
#
# Date: 30/03/2015
#
# URL: http://www.ucodev.org
#
# This file is part of uConf.
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#


SETUP_OS=`uname 2> /dev/null`
SETUP_SHELL=`cat ./uconf/params/${SETUP_OS}/shell 2> /dev/null`

if [ ${?} -ne 0 ]; then
	echo "Your system is not supported."
	exit 1
fi

echo ${SETUP_SHELL}

# Setup 'addon' script
SETUP_SCRIPT="addon_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}

# Setup 'confdir' script
SETUP_SCRIPT="confdir_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}

# Setup 'do' script
SETUP_SCRIPT="do_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}

# Setup 'install' script
SETUP_SCRIPT="install_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}

# Setup 'target' script
SETUP_SCRIPT="target_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}

# Setup 'undo' script
SETUP_SCRIPT="undo_main"
ls ./uconf/bin/${SETUP_SCRIPT}.orig 2> /dev/null > /dev/null
if [ ${?} -ne 0 ]; then
	cp ./uconf/bin/${SETUP_SCRIPT} ./uconf/bin/${SETUP_SCRIPT}.orig
fi
sed 's/@_SYSSHELL_@/'$(echo ${SETUP_SHELL} | tr -d '\n' | sed 's/\//\\\//g')'/g' ./uconf/bin/${SETUP_SCRIPT} > ./uconf/bin/${SETUP_SCRIPT}.bak 2> /dev/null
mv ./uconf/bin/${SETUP_SCRIPT}.bak ./uconf/bin/${SETUP_SCRIPT}
chmod 755 ./uconf/bin/${SETUP_SCRIPT}


